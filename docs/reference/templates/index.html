

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Templating &mdash; PyMzn 0.16.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="PyMzn 0.16.1 documentation" href="../../index.html"/>
        <link rel="up" title="Manual" href="../index.html"/>
        <link rel="next" title="pymzn.add_package" href="generated/pymzn.add_package.html"/>
        <link rel="prev" title="pymzn.SolveStatement" href="../model/generated/pymzn.SolveStatement.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> PyMzn
          

          
          </a>

          
            
            
              <div class="version">
                0.16.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick_start.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../minizinc/index.html">MiniZinc tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dzn/index.html">Dzn files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../solvers/index.html">Solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model/index.html">Modelling</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Templating</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pymzn.add_package.html">pymzn.add_package</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pymzn.add_path.html">pymzn.add_path</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process.html">Process execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internal.html">Implementation details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PyMzn</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Manual</a> &raquo;</li>
        
      <li>Templating</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/reference/templates/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="templating">
<h1>Templating<a class="headerlink" href="#templating" title="Permalink to this headline">Â¶</a></h1>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/pymzn.add_package.html#pymzn.add_package" title="pymzn.add_package"><code class="xref py py-obj docutils literal"><span class="pre">add_package</span></code></a>(package_name[,&nbsp;package_path,&nbsp;...])</td>
<td>Adds the given package to the template search routine</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/pymzn.add_path.html#pymzn.add_path" title="pymzn.add_path"><code class="xref py py-obj docutils literal"><span class="pre">add_path</span></code></a>(searchpath[,&nbsp;encoding,&nbsp;followlinks])</td>
<td>Adds the given path to the template search routine</td>
</tr>
</tbody>
</table>
<span class="target" id="module-pymzn.mzn.templates"></span><p>Handles MiniZinc template files.</p>
<p>PyMzn supports templating as a form of dynamic modelling. PyMzn allows to embed
code from the <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a> templating language within a
MiniZinc model to make a PyMzn template file (usually distinguished with the
<em class="xref py py-obj">pmzn</em> extension). An example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%%</span> <span class="n">knapsack</span><span class="o">.</span><span class="n">pmzn</span> <span class="o">%%</span>
<span class="nb">int</span><span class="p">:</span> <span class="n">n</span><span class="p">;</span>                     <span class="o">%</span> <span class="n">number</span> <span class="n">of</span> <span class="n">objects</span>
<span class="nb">set</span> <span class="n">of</span> <span class="nb">int</span><span class="p">:</span> <span class="n">OBJ</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">.</span><span class="n">n</span><span class="p">;</span>
<span class="nb">int</span><span class="p">:</span> <span class="n">capacity</span><span class="p">;</span>              <span class="o">%</span> <span class="n">the</span> <span class="n">capacity</span> <span class="n">of</span> <span class="n">the</span> <span class="n">knapsack</span>
<span class="n">array</span><span class="p">[</span><span class="n">OBJ</span><span class="p">]</span> <span class="n">of</span> <span class="nb">int</span><span class="p">:</span> <span class="n">size</span><span class="p">;</span>    <span class="o">%</span> <span class="n">the</span> <span class="n">size</span> <span class="n">of</span> <span class="n">each</span> <span class="nb">object</span><span class="o">=</span>

<span class="n">var</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">OBJ</span><span class="p">:</span> <span class="n">x</span><span class="p">;</span>
<span class="n">constraint</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)(</span><span class="n">size</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">capacity</span><span class="p">;</span>

<span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;profit&#39;</span> <span class="o">%</span><span class="p">}</span>
    <span class="n">array</span><span class="p">[</span><span class="n">OBJ</span><span class="p">]</span> <span class="n">of</span> <span class="nb">int</span><span class="p">:</span> <span class="n">profit</span><span class="p">;</span>  <span class="o">%</span> <span class="n">the</span> <span class="n">profit</span> <span class="n">of</span> <span class="n">each</span> <span class="nb">object</span>
    <span class="n">solve</span> <span class="n">maximize</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)(</span><span class="n">profit</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">{</span><span class="o">%</span> <span class="k">elif</span> <span class="n">objective</span> <span class="o">==</span> <span class="s1">&#39;cost&#39;</span> <span class="o">%</span><span class="p">}</span>
    <span class="n">array</span><span class="p">[</span><span class="n">OBJ</span><span class="p">]</span> <span class="n">of</span> <span class="nb">int</span><span class="p">:</span> <span class="n">cost</span><span class="p">;</span>    <span class="o">%</span> <span class="n">the</span> <span class="n">cost</span> <span class="n">of</span> <span class="n">each</span> <span class="nb">object</span>
    <span class="n">solve</span> <span class="n">minimize</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)(</span><span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
    <span class="n">solve</span> <span class="n">satisfy</span><span class="p">;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span><span class="o">%</span><span class="p">}</span>

<span class="o">%%</span> <span class="n">knapsack</span><span class="o">.</span><span class="n">dzn</span> <span class="o">%%</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">];</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</pre></div>
</div>
<p>Now it is possible to pass <em class="xref py py-obj">objective</em> as a member of <em class="xref py py-obj">args</em> in the
<a class="reference internal" href="../minizinc/generated/pymzn.minizinc.html#pymzn.minizinc" title="pymzn.minizinc"><code class="xref py py-obj docutils literal"><span class="pre">pymzn.minizinc</span></code></a> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pymzn</span><span class="o">.</span><span class="n">minizinc</span><span class="p">(</span><span class="s1">&#39;knapsack.pmzn&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cost&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]},</span> <span class="n">args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;cost&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>The compiled model that will be solved looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%%</span> <span class="n">knapsack</span><span class="o">.</span><span class="n">mzn</span> <span class="o">%%</span>
<span class="nb">int</span><span class="p">:</span> <span class="n">n</span><span class="p">;</span>                     <span class="o">%</span> <span class="n">number</span> <span class="n">of</span> <span class="n">objects</span>
<span class="nb">set</span> <span class="n">of</span> <span class="nb">int</span><span class="p">:</span> <span class="n">OBJ</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">.</span><span class="n">n</span><span class="p">;</span>
<span class="nb">int</span><span class="p">:</span> <span class="n">capacity</span><span class="p">;</span>              <span class="o">%</span> <span class="n">the</span> <span class="n">capacity</span> <span class="n">of</span> <span class="n">the</span> <span class="n">knapsack</span>
<span class="n">array</span><span class="p">[</span><span class="n">OBJ</span><span class="p">]</span> <span class="n">of</span> <span class="nb">int</span><span class="p">:</span> <span class="n">size</span><span class="p">;</span>    <span class="o">%</span> <span class="n">the</span> <span class="n">size</span> <span class="n">of</span> <span class="n">each</span> <span class="nb">object</span><span class="o">=</span>

<span class="n">var</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">OBJ</span><span class="p">:</span> <span class="n">x</span><span class="p">;</span>
<span class="n">constraint</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)(</span><span class="n">size</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">capacity</span><span class="p">;</span>

<span class="n">array</span><span class="p">[</span><span class="n">OBJ</span><span class="p">]</span> <span class="n">of</span> <span class="nb">int</span><span class="p">:</span> <span class="n">cost</span><span class="p">;</span>    <span class="o">%</span> <span class="n">the</span> <span class="n">cost</span> <span class="n">of</span> <span class="n">each</span> <span class="nb">object</span>
<span class="n">solve</span> <span class="n">minimize</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)(</span><span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</pre></div>
</div>
<p>Notice that now the model expects a <em class="xref py py-obj">cost</em> array as dzn input data, so we passed
it with the <em class="xref py py-obj">data</em> argument as usual.</p>
<p>As mentioned, PyMzn employs Jinja2 under the hood, so anything you can do with
Jinja2 is also possible in PyMzn, including variables, control structured,
template inheritance, and filters. PyMzn implements few custom filters as well:</p>
<ul class="simple">
<li><em class="xref py py-obj">int(value, factor=100)</em> : discretizes the given input or array,
pre-multiplying by the given factor.</li>
<li><em class="xref py py-obj">dzn(value)</em> : transform the input into its equivalent dzn string.</li>
</ul>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="generated/pymzn.add_package.html" class="btn btn-neutral float-right" title="pymzn.add_package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../model/generated/pymzn.SolveStatement.html" class="btn btn-neutral" title="pymzn.SolveStatement" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Paolo Dragone (MIT Licence).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.16.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>